var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},debugoutDefaults={realTimeLoggingOn:!0,useTimestamps:!1,includeSessionMetadata:!0,useLocalStorage:!1,recordLogs:!0,autoTrim:!0,maxLines:3e3,tailNumLines:25,maxDepth:20,logFilename:"debugout.txt",localStorageKey:"debugout.js",indent:"  ",quoteStrings:!0},Debugout=function(){function t(t){var e=this;this.indent="  ",this.tailNumLines=25,this.output="",this.version=function(){return"1.1.0"},this.indentsForDepth=function(t){return e.indent.repeat(Math.max(t,0))},this.trace=function(){return console.trace()},this.time=function(){return console.time()},this.timeEnd=function(){return console.timeEnd()};var o=__assign(__assign({},debugoutDefaults),t);for(var i in o)void 0!==o[i]&&(this[i]=o[i]);if(this.useLocalStorage&&window&&window.localStorage){var r=this.load();if(r){this.output=r.log,this.startTime=new Date(r.startTime);var n=new Date(r.lastLog);this.logMetadata("Last session end: "+r.lastLog),this.logMetadata("Last "+this.formatSessionDuration(this.startTime,n)),this.startLog()}else this.startLog()}else this.useLocalStorage=!1,this.startLog()}return t.prototype.startLog=function(){this.startTime=new Date,this.logMetadata("Session started: "+this.formatDate(this.startTime))},t.prototype.recordLog=function(){for(var t=this,e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];if(this.useTimestamps&&(this.output+=this.formatDate()+" "),this.output+=e.map(function(e){return t.stringify(e)}).join(" "),this.output+="\n",this.autoTrim&&(this.output=this.trimLog(this.maxLines)),this.useLocalStorage){var i={startTime:this.startTime,log:this.output,lastLog:new Date};window.localStorage.setItem(this.localStorageKey,JSON.stringify(i))}},t.prototype.logMetadata=function(t){this.includeSessionMetadata&&(this.output+="---- "+t+" ----\n")},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.realTimeLoggingOn&&console.log.apply(console,t),this.recordLogs&&this.recordLog.apply(this,t)},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.realTimeLoggingOn&&console.info.apply(console,t),this.recordLogs&&(this.output+="[INFO] ",this.recordLog.apply(this,t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.realTimeLoggingOn&&console.warn.apply(console,t),this.recordLogs&&(this.output+="[WARN] ",this.recordLog.apply(this,t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.realTimeLoggingOn&&console.error.apply(console,t),this.recordLogs&&(this.output+="[ERROR] ",this.recordLog.apply(this,t))},t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.realTimeLoggingOn&&console.debug.apply(console,t),this.recordLogs&&(this.output+="[DEBUG] ",this.recordLog.apply(this,t))},t.prototype.getLog=function(){var t=new Date;if(this.recordLogs||this.info("Log recording is off"),this.useLocalStorage&&window&&window.localStorage){var e=this.load();e&&(this.startTime=new Date(e.startTime),this.output=e.log)}return this.includeSessionMetadata?this.output+"---- "+this.formatSessionDuration(this.startTime,t)+" ----\n":this.output},t.prototype.clear=function(){this.output="",this.logMetadata("Session started: "+this.formatDate(this.startTime)),this.logMetadata("Log cleared "+this.formatDate()),this.useLocalStorage&&this.save()},t.prototype.tail=function(t){var e=t||this.tailNumLines;return this.trimLog(e)},t.prototype.search=function(t){for(var e=new RegExp(t,"ig"),o=this.output.split("\n"),i=[],r=0;r<o.length;r++){var n="["+r+"] ";o[r].match(e)&&i.push(n+o[r].trim())}var s=i.join("\n");return s.length||(s='Nothing found for "'+t+'".'),s},t.prototype.slice=function(){for(var t,e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return(t=this.output.split("\n")).slice.apply(t,e).join("\n")},t.prototype.downloadLog=function(){if(window){var t=this.getLog(),e=new Blob([t],{type:"data:text/plain;charset=utf-8"}),o=document.createElement("a");o.href=window.URL.createObjectURL(e),o.target="_blank",o.download=this.logFilename,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(o.href)}else console.error("downloadLog only works in the browser")},t.prototype.save=function(){var t={startTime:this.startTime,log:this.output,lastLog:new Date};window.localStorage.setItem(this.localStorageKey,JSON.stringify(t))},t.prototype.load=function(){var t=window.localStorage.getItem(this.localStorageKey);return t?JSON.parse(t):null},t.prototype.determineType=function(e){if(null===e)return"null";if(void 0===e)return"undefined";var o=typeof e;return"object"===o&&(o=Array.isArray(e)?"Array":e instanceof Date?"Date":e instanceof RegExp?"RegExp":e instanceof t?"Debugout":"Object"),o},t.prototype.stringifyObject=function(t,e){void 0===e&&(e=0);var o="{",i=e;if(this.objectSize(t)>0){o+="\n",i++;var r=0;for(var n in t){o+=this.indentsForDepth(i),o+=n+": ";var s=this.stringify(t[n],i);s&&(o+=s),r<this.objectSize(t)-1&&(o+=","),o+="\n",r++}i--,o+=this.indentsForDepth(i)}return o+="}"},t.prototype.stringifyArray=function(t,e){void 0===e&&(e=0);var o="[",i=e,r=!1;if(t.length>0){i++;for(var n=0;n<t.length;n++){var s=this.determineType(t[n]),a=!1;"Object"===s&&this.objectSize(t[n])>0&&(a=!0),"Array"===s&&t[n].length>0&&(a=!0),!r&&a&&(o+="\n");var u=this.stringify(t[n],i);u&&(a&&(o+=this.indentsForDepth(i)),o+=u,n<t.length-1&&(o+=", "),a&&(o+="\n")),r=a}i--}return o+="]"},t.prototype.stringifyFunction=function(t,e){var o=this;void 0===e&&(e=0);var i=e;return String(t).split("\n").map(function(t){t.match(/\}/)&&i--;var e=o.indentsForDepth(i)+t.trim();return t.match(/\{/)&&i++,e}).join("\n")},t.prototype.stringify=function(t,e){if(void 0===e&&(e=0),e>=this.maxDepth)return"... (max-depth reached)";var o=this.determineType(t);switch(o){case"Object":return this.stringifyObject(t,e);case"Array":return this.stringifyArray(t,e);case"function":return this.stringifyFunction(t,e);case"RegExp":return"/"+t.source+"/"+t.flags;case"Date":case"string":return this.quoteStrings?'"'+t+'"':t+"";case"boolean":return t?"true":"false";case"number":return t+"";case"null":case"undefined":return o;case"Debugout":return"... (Debugout)";default:return"?"}},t.prototype.trimLog=function(t){var e=this.output.split("\n");return e.pop(),e.length>t&&(e=e.slice(e.length-t)),e.join("\n")+"\n"},t.prototype.formatSessionDuration=function(t,e){var o=e-t,i=Math.floor(o/1e3/60/60),r=("0"+i).slice(-2);o-=1e3*i*60*60;var n=Math.floor(o/1e3/60),s=("0"+n).slice(-2);o-=1e3*n*60;var a=Math.floor(o/1e3);return o-=1e3*a,"Session duration: "+r+":"+s+":"+("0"+a).slice(-2)},t.prototype.formatDate=function(t){return void 0===t&&(t=new Date),"["+t.toISOString()+"]"},t.prototype.objectSize=function(t){var e=0;for(var o in t)t.hasOwnProperty(o)&&e++;return e},t}();export{Debugout};